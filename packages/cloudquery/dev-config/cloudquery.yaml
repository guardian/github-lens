---
kind: source
spec:
  name: 'aws'
  path: 'cloudquery/aws'

  # Track releases on https://github.com/cloudquery/cloudquery/releases?q=plugins-source-aws
  version: 'v17.4.0'
  destinations: ['postgresql']
  skip_tables:
    - aws_ec2_vpc_endpoint_services
    - aws_cloudtrail_events
    - aws_docdb_cluster_parameter_groups
    - aws_docdb_engine_versions
    - aws_ec2_instance_types
    - aws_elasticache_engine_versions
    - aws_elasticache_parameter_groups
    - aws_elasticache_reserved_cache_nodes_offerings
    - aws_elasticache_service_updates
    - aws_neptune_cluster_parameter_groups
    - aws_neptune_db_parameter_groups
    - aws_rds_cluster_parameter_groups
    - aws_rds_db_parameter_groups
    - aws_rds_engine_versions
    - aws_servicequotas_services
    - aws_identitystore_users
    - aws_identitystore_groups
    - aws_quicksight_data_sets
    - aws_quicksight_dashboards
    - aws_quicksight_analyses
    - aws_quicksight_users
    - aws_quicksight_templates
    - aws_quicksight_groups
    - aws_quicksight_folders
    - aws_quicksight_data_sources
    - aws_amp_workspaces
    - aws_ssoadmin_instances
    - aws_glue_connections
    - aws_computeoptimizer_ecs_service_recommendations
    - aws_xray_sampling_rules
    - aws_xray_resource_policies
    - aws_xray_groups
  spec:
    regions:
      - eu-west-1
      - us-east-1
    accounts:
      - id: 'developerPlayground'
        local_profile: 'developerPlayground'
---
kind: source
spec:
  name: 'template-summary'
  path: 'guardian/cloudformation-template-summary'
  version: 'v0.3.0'
  tables: ['*']
  destinations: ['postgresql']
  spec:
    regions:
      - eu-west-1
      - us-east-1
    accounts:
      - id: 'developerPlayground'
        local_profile: 'developerPlayground'

---
kind: source
spec:
  # Source spec section
  name: 'github'
  path: 'cloudquery/github'
  version: 'v5.2.0'
  tables: ['*']
  destinations: ['postgresql']
  spec:
    ## App Authentication (one per org):
    app_auth:
      - org: 'guardian'
        private_key_path: '/github-key' # Path to private key file
        app_id: '${GITHUB_APP_ID}' # App ID, required for App Authentication.
        installation_id: '${GITHUB_INSTALLATION_ID}' # Installation ID for this org
    #orgs: [] # Optional. List of organizations to extract from
    repos: [
        # example devX owned repos
        'guardian/cdk',
        'guardian/service-catalogue',

        # example non-devX repo
        'guardian/dotcom-rendering',

        # example private repo
        'guardian/tracker',
      ] # Optional. List of repositories to extract from

---
kind: destination
spec:
  name: 'postgresql'
  registry: 'github'
  path: 'cloudquery/postgresql'

  # Track releases on https://github.com/cloudquery/cloudquery/releases?q=plugins-destination-postgresql-&expanded=true
  version: 'v4.2.0'

  # Automatically apply migrations whenever plugins are updated.
  # Note: This is not encouraged if risk averse, so we should consider removing this once fully in production.
  # See: https://www.cloudquery.io/docs/advanced-topics/managing-versions#managing-plugin-versions
  migrate_mode: 'forced'

  spec:
    connection_string: 'postgresql://postgres:not_at_all_secret@postgres:5432/postgres?sslmode=disable'
