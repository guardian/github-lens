---
kind: source
spec:
  # Source spec section
  name: 'github'
  path: 'cloudquery/github'
  version: v${CQ_GITHUB}
  tables: ['*']
  destinations: ['postgresql']
  spec:
    access_token: ${GITHUB_ACCESS_TOKEN}
    repos: [
        # example devX owned repos
        'guardian/cdk',
        'guardian/service-catalogue',

        # example non-devX repo
        'guardian/dotcom-rendering',

        # example private repo
        'guardian/tracker',

        #75 public repos selected at random from the guardian org
        'guardian/isw-mapshaper-extractor',
        'guardian/embed-tool',
        'guardian/sophie-practical-scala-test',
        'guardian/animated-frontier-massacres',
        'guardian/media-flipper',
        'guardian/world-map',
        'guardian/sbt-benchmark-plugin',
        'guardian/brother-audio-wall-202103',
        'guardian/gdn-smooth-operator',
        'guardian/grid-permissions',
        'guardian/dog-relatedness',
        'guardian/main-media-sv-addiction',
        'guardian/backend-101-scala-starter-ParisaTork',
        'guardian/zuora-undo',
        'guardian/Oz_covid_bans',
        'guardian/fonts',
        'guardian/doc-cards',
        'guardian/odd-job',
        'guardian/nsw-state-election-2019',
        'guardian/online-abuse-analysis',
        'guardian/rockers',
        'guardian/element-aws-config',
        'guardian/drought-map-australia',
        'guardian/course-outline',
        'guardian/watchman',
        'guardian/guss-grid-system',
        'guardian/word-of-the-year',
        'guardian/oz-230213-emissions-offset-scraper',
        'guardian/test-api-gateway-workshop',
        'guardian/prout',
        'guardian/gu-who',
        'guardian/gocapimodels',
        'guardian/react2angular',
        'guardian/gu-most-popular',
        'guardian/techtime',
        'guardian/teamcity-queue-boss-plugin',
        'guardian/acquisition-iframe-tracking',
        'guardian/ing-audio-wall-202107',
        'guardian/content-api-scala-client',
        'guardian/source-shakedown',
        'guardian/skf-flask',
        'guardian/202206-Griffith-image-grid',
        'guardian/main-media-black-power-video',
        'guardian/cq-source-snyk-full-project',
        'guardian/land-clearing-gis-relocator-tool-global',
        'guardian/page-enhancer-back-to-top-btn',
        'guardian/get-programming-with-scala',
        'guardian/element-aws-identity',
        'guardian/elasticsearch-monitoring-demo',
        'guardian/nla-pageview-job',
        'guardian/autosave-browser',
        'guardian/trump-russia-embeds',
        'guardian/scala-school-test1',
        'guardian/csrf-example',
        'guardian/giant',
        'guardian/flexible-restorer',
        'guardian/iframe-messenger',
        'guardian/scribe-plugin-blockquote-command',
        'guardian/repo-apocalypse',
        'guardian/support-shared-tokens',
        'guardian/sauce-connect-launcher',
        'guardian/https-ready',
        'guardian/most-viewed-video-uploader',
        'guardian/flexible-octopus-converter',
        'guardian/reusable-line-chart-v1',
        'guardian/dotcom-logic',
        'guardian/argogo',
        'guardian/ajwl-scala-lambda-test',
        'guardian/opsm-immersive-2020',
        'guardian/paygap-automated-story',
        'guardian/hackday-particulers',
        'guardian/yacht-charter-python-library',
        'guardian/ipv6-checker',
        'guardian/mobile-notifications-api-client',
        'guardian/high-five-the-archive',

      ]
---
kind: source
spec:
  name: 'aws'
  path: 'cloudquery/aws'
  version: v${CQ_AWS}
  destinations: ['postgresql']
  tables:
    - '*'
  skip_tables:
    - aws_ec2_vpc_endpoint_services
    - aws_cloudtrail_events
    - aws_docdb_cluster_parameter_groups
    - aws_docdb_engine_versions
    - aws_ec2_instance_types
    - aws_elasticache_engine_versions
    - aws_elasticache_parameter_groups
    - aws_elasticache_reserved_cache_nodes_offerings
    - aws_elasticache_service_updates
    - aws_neptune_cluster_parameter_groups
    - aws_neptune_db_parameter_groups
    - aws_rds_cluster_parameter_groups
    - aws_rds_db_parameter_groups
    - aws_rds_engine_versions
    - aws_servicequotas_services
    - aws_identitystore_users
    - aws_identitystore_groups
    - aws_quicksight_data_sets
    - aws_quicksight_dashboards
    - aws_quicksight_analyses
    - aws_quicksight_users
    - aws_quicksight_templates
    - aws_quicksight_groups
    - aws_quicksight_folders
    - aws_quicksight_data_sources
    - aws_amp_workspaces
    - aws_ssoadmin_instances
    - aws_glue_connections
    - aws_computeoptimizer_ecs_service_recommendations
    - aws_xray_sampling_rules
    - aws_xray_resource_policies
    - aws_xray_groups
  spec:
    regions:
      - eu-west-1
      - us-east-1
    accounts:
      - id: 'developerPlayground'
        local_profile: 'developerPlayground'
---
kind: source
spec:
  name: 'snyk'
  path: 'cloudquery/snyk'
  version: v${CQ_SNYK}
  destinations: ['postgresql']
  tables:
    - snyk_dependencies
    - snyk_groups
    - snyk_group_members
    - snyk_integrations
    - snyk_organizations
    - snyk_organization_members
    - snyk_organization_provisions
    - snyk_reporting_issues
    - snyk_reporting_latest_issues
  spec:
    api_key: ${SNYK_TOKEN}
    table_options:
      snyk_reporting_issues:
        period: 30d
---
kind: source
spec:
  name: 'guardian-snyk'
  # https://github.com/guardian/cq-source-snyk-full-project
  path: guardian/snyk-full-project
  version: v0.1.1
  tables:
    - snyk_projects
  destinations:
    - postgresql
  spec:
    api_key: ${SNYK_TOKEN}
---
kind: destination
spec:
  name: 'postgresql'
  registry: 'github'
  path: 'cloudquery/postgresql'
  version: v${CQ_POSTGRES}

  # Automatically apply migrations whenever plugins are updated.
  # Note: This is not encouraged if risk averse, so we should consider removing this once fully in production.
  # See: https://www.cloudquery.io/docs/advanced-topics/managing-versions#managing-plugin-versions
  migrate_mode: 'forced'

  spec:
    connection_string: 'postgresql://postgres:not_at_all_secret@postgres:5432/postgres?sslmode=disable'
