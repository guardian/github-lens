kind: source
spec:
  name: 'aws'
  path: 'cloudquery/aws'

  # Track releases on https://github.com/cloudquery/cloudquery/releases?q=plugins-source-aws
  version: 'v17.0.0'
  destinations: ['postgresql']
  skip_tables:
    - aws_ec2_vpc_endpoint_services # this resource includes services that are available from AWS as well as other AWS Accounts
    - aws_cloudtrail_events
    - aws_docdb_cluster_parameter_groups
    - aws_docdb_engine_versions
    - aws_ec2_instance_types
    - aws_elasticache_engine_versions
    - aws_elasticache_parameter_groups
    - aws_elasticache_reserved_cache_nodes_offerings
    - aws_elasticache_service_updates
    - aws_neptune_cluster_parameter_groups
    - aws_neptune_db_parameter_groups
    - aws_rds_cluster_parameter_groups
    - aws_rds_db_parameter_groups
    - aws_rds_engine_versions
    - aws_servicequotas_services
    - aws_identitystore_users
    - aws_identitystore_groups
    - aws_quicksight_data_sets
    - aws_quicksight_dashboards
    - aws_quicksight_analyses
    - aws_quicksight_users
    - aws_quicksight_templates
    - aws_quicksight_groups
    - aws_quicksight_folders
    - aws_quicksight_data_sources
    - aws_amp_workspaces
    - aws_ssoadmin_instances
    - aws_glue_connections
    - aws_computeoptimizer_ecs_service_recommendations
    - aws_xray_sampling_rules
    - aws_xray_resource_policies
    - aws_xray_groups

    # These tables are being collected by the ECS infrastructure
    - aws_s3_buckets
    - aws_lambda_functions
    - aws_organizations
    - aws_organizations_accounts
    - aws_organizations_delegated_services
    - aws_organizations_delegated_administrators
    - aws_organizations_organizational_units
    - aws_organizations_policies
    - aws_organizations_roots
  concurrency: 100000 # this is expected to work with a t4g.medium and our current sources but not optimised. Will adjust once live.
  spec:
    regions:
      # All regions we support.
      # See https://github.com/guardian/infosec-platform/blob/main/policies/DenyAccessToNonApprovedRegions.json
      - eu-west-1
      - eu-west-2
      - us-east-1
      - us-east-2
      - us-west-1
      - ap-southeast-2
      - ca-central-1
    org:
      member_role_name: cloudquery-access # See: https://github.com/guardian/aws-account-setup/pull/58.
      organization_units:
        - £TARGET_ORG_UNIT
